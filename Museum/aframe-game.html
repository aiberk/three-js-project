<html>
  <head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script>
      //  TODO
      // - Create 3D Model - Done
      // - Create hover,failure,and success animations
      // - Export to Gltf
      // - Add to Code
      // - Figure out Lights
      // - Figure out Camera
      // - Figure out Sound
    </script>
    <script>
      const chosen_box = Math.floor(Math.random() * 3);
      let click_count = 0;
      var success_sound = document.querySelector("#success");
      console.log("success_sound=" + success_sound);

      AFRAME.registerComponent("foo", {
        schema: {},
        init: function () {
          var data = this.data;
          var el = this.el;
          let success_sound = document.querySelector("#success");
          let rejected_sound = document.querySelector("#rejected");
          let hover_sound = document.querySelector("#hover");

          el.addEventListener("click", function () {
            if (this.id == chosen_box) {
              success_sound.play();
              el.setAttribute("animation-mixer", {
                clip: "open",
                loop: "repeat",
                repetitions: 1,
              });
            } else {
              console.log("Try again" + this.id);
              rejected_sound.play();
              el.setAttribute("animation-mixer", {
                clip: "reject",
                loop: "repeat",
                repetitions: 1,
              });
            }
          });

          el.addEventListener("mouseenter", function () {
            hover_sound.play();
            el.setAttribute("animation-mixer", {
              clip: "hover",
              loop: "repeat",
              repetitions: 1,
            });
          });

          el.addEventListener("mouseleave", function () {
            var mesh = el.getObject3D("mesh");
            el.setAttribute("animation-mixer", {
              clip: "pirate shipAction.007",
              loop: "repeat",
              repetitions: 2,
            });
          });
        },
        update: function (oldData) {
          this.el = this.data;
        },
        tick: function () {},
        remove: function () {},
        pause: function () {},
        play: function () {},
      });

      AFRAME.registerComponent("message", {
        schema: { value: "Chest Game" },
        init: function () {
          var data = this.data;
          var el = this.el;

          el.addEventListener("click", function () {});
        },
        update: function (oldData) {
          this.el = this.data;
        },
        tick: function () {},
        remove: function () {},
        pause: function () {},
        play: function () {},
      });
    </script>
  </head>
  <body>
    <a-scene id="container">
      <a-assets>
        <a-asset-item id="suzy-gltf" src="assets/t4.glb"></a-asset-item>

        <a-asset-tiem id="museum" src="assets/m2.png"></a-asset-tiem>
        <audio id="hover" src="assets/hover_audio.mp3" preload="auto"></audio>
        <audio id="success" src="assets/success.mp3" preload="auto"></audio>
        <audio
          id="rejected"
          src="assets/rrejected_audio.mp3"
          preload="auto"
        ></audio>
      </a-assets>
      <!-- <a-sound src="#success" autoplay="true"></a-sound> -->
      <a-entity light position="0 1 -0.456"></a-entity>
      <a-entity light position="0 0 -0.456"></a-entity>
      <a-entity light position="0 -1 -0.456"></a-entity>

      <a-entity
        id="camera"
        camera="userHeight: 1.6"
        look-controls
        cursor="rayOrigin: mouse"
      ></a-entity>

      <a-text
        message
        value="Chest Game"
        scale=""
        position="-0.6 0.58877 -2"
        rotation=""
        id="main-text"
        text=""
      ></a-text>

      <a-entity
        foo
        id="0"
        gltf-model="#suzy-gltf"
        position="-2 -1.407 -4.151"
        scale="0.3 0.3 0.3"
        rotation="0 180 0"
      ></a-entity>

      <a-entity
        foo
        id="1"
        gltf-model="#suzy-gltf"
        position="0 -1.407 -4.151"
        scale="0.3 0.3 0.3"
        rotation="0 180 0"
      ></a-entity>

      <a-entity
        foo
        id="2"
        gltf-model="#suzy-gltf"
        position="2 -1.407 -4.151"
        scale="0.3 0.3 0.3"
        rotation="0 180 0"
        sound="src: url(assets/succes.mp3); on: click;"
      ></a-entity>
      <a-sky color="#000"></a-sky>
    </a-scene>
  </body>
</html>
